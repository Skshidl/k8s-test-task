# k8s-test-task

## Тестовое задание
Для теста взял образ  nginx и создал NodePort service для проверки работоспособности.

Пойдем по пунктам, здесь буду расписывать свои размышления, но так же пометки будут в комментариях в deployment
1. Так как у нас мультизональный кластер (три зоны), в котором пять нодов. Нужно ими пользоваться, как ни странно, поэтому чтобы наш планировщик не разместил все наши replicas на одном ноде, будем использовать *PodAntiAffinity*. И в случае падения нода, у нас приложение будет работать.
Нашел полезную информацию здесь:
https://kubernetes.io/docs/concepts/scheduling-eviction/assign-pod-node/
2. Приложение требует около 5-10 секунд для инициализации, поэтому нам нужны heatlhcheck чтобы проверить готовность приложения. Будем использовать:
- *ReadinessProbe* - Начинает проверку после 5 секунд, и проверяет каждые 5 секунд. Если все ок - контейнер будет принимать трафик
- *LivenessProbe* - Запускаем через 15 секунд, чтобы *ReadinessProbe* мог сделать 1-2 проверки, если контейнер будет не работать, наша проба его перезапустит.
Источник: https://cloud.google.com/blog/products/containers-kubernetes/kubernetes-best-practices-setting-up-health-checks-with-readiness-and-liveness-probes
3. Знаем что нам нужно 4 пода. Этой информацией воспользуемся позже.
4. Знаем что нам нужно минимум 0.1 CPU и максимум 128M Memory. Воспользуемся *limits* и *requests*. Так как мы знаем только минимум у CPU, поэтому он пойдет в requests, а память туда и в *limits*.
Источник: https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/
5. Мы понимаем, что нагрузка у нас разная, поэтому нам может помочь *HPA* для экономии ресурсов. Который будет поднимать поды, если нагрузка будет расти. Воспользуемся той информацией, что нам хватает 4 подов, поэтому у нас будет scaling от 1 до 4 подов. И предположим,что у нодов 1 CPU. Выполним не хитрое арифметическое действие 100/4=25. Поэтому установим в *HPA* 20% - это та нагрузка после которой будут подниматься новые ноды.
Источник: https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale-walkthrough/


## Для обратной свзяи
Буду ждать фидбек, а то интересная информация, да и изучение чего-то нового - всегда круто!

skshidlevsky@gmail.com

[TG](https://t.me/skshidl) 





